{% extends "base.html" %}

{% block title %}Test Case Form{% endblock %}

{% block head %}
<link rel="stylesheet" type="text/css" media="screen" href="/static/jqGrid/css/ui-lightness/jquery-ui-1.8.21.custom.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/static/jqGrid/css/ui.jqgrid.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/static/jqGrid/css/ui.multiselect.css" />

{% endblock %}

{% block content %}
<div class="span10" id="content">
<div class="well" id="wellContent" > <!--this gets closed on design step condition in the django for loop -->

<!-- the onsubmit functions live in static/js/design_steps.js -->
<form method="post" action="." class="form-horizontal" onsubmit="return validate()" name="Form" id="Form">

{% csrf_token %}
    <legend style="text-align:right">
        <h2 class="pull-left">  {{ type }}  </h2>
        <span>
           <a href="./result"> Progress Report</a>
        </span>
    </legend>

<p><u id="note">Note: Bold fields are <b>required</b></u></p>
<br />
<div id="fields form">

  <!-- Display Test Case ID if editing a test case-->
  {% if id %}
  <div class="control-group">
    <label  class="control-label" id="id"><b>ID:</b></label>
    <div class="controls ">
      <span> {{id}} </span>
    </div>
  </div>
  {% endif %}
  <!-- End Display ID -->

  {% for field in form %}
    <div class="control-group">
      {{ field.errors }}
      <!-- if the field is design_steps, put in the custom table -->
      {% if field.html_name == "design_steps" %}
        <label class="control-label" id="design_steps"> <span id="label_design_steps">Design Steps</span>: </label>
        <div class="controls" style="">
          <table id="designstepsTable" class="scroll"></table>
          <div id="gridpager"></div> 
          <span class="help-block"> 
            Click on a row to start editing. <br/>
            Press [shift+enter] to create a new line, or [enter] to finish editing. <br/>
            Select a row and click "Delete Row" to delete a row.
          </span>
        </div>
        
      <!-- if field is the author / creator, manually put in the data so its read only -->
      {% else %}{% if field.html_name == "author"%}
        {{ field }}
        <label class="control-label" id="{{ field.html_name }}"><span id="label_{{field.html_name}}">{{ field.label }}</span>:</label>
        <div class="controls">
          {{ author }}
        </div>
        
      <!-- category field will be placed later manually, and should not be added normally by django.
          this is where every other field gets placed -->
      {% else %}{% if field.html_name != "category" and field.html_name != "creation_date" %} <!-- Normal Fields -->
        <label class="control-label" id="{{ field.html_name }}"><span id="label_{{field.html_name}}">{{ field.label }}</span>:
        <span class="help-block">{{ field.help_text }}</span>
        </label>

        <div class="controls ">
          {{ field }}
        </div>
        
        <!-- if the product field comes up, it gets normally placed by the above statement by django.
             The category field should come after product and gets manually placed, with the options dynamically changing
             based on the product selected. This is done with ajax -->
        {% if field.html_name == "product" %}
          <br />
          <div class="control-group">
            <label class="control-label" id="category"><span id="label_category">Category</span>:
            <span class="help-block"> Category options change dynamically depending on "product" selection </span>
            </label>    
            <div class="controls ">
              <select name="category" id="id_category">
                <option value="" selected="selected">---------</option>
              </select>
              
            </div>
          </div>
        {% endif %}
      {% endif %}{% endif %}{% endif %}
        
    </div>
  {% endfor %}

</div>

<input type="submit" class="btn btn-info" value="Submit"/>
</form>
</div>

</div>
{% endblock %}

<!-- Start of the test phases form -->
<div id="phases form">
  <legend><h2> Add test Phases </h2></legend>
    <div class="control-group">
      <label class="control-label" id="{{ phase.html_name }}"><span id="label_{{phase.html_name}}">{{ phase.name }}</span>:
         <span class="help-block">{{ phase.help_text }}</span>
       </label>
       <div class="controls ">
         {{ phase.name }}
       </div>
    </div>
    <input type="submit" class="btn btn-info" value="Submit"/>
</div>
<!-- End of the test phases form -->

{% block post_js %}
    <script src="/static/jquery.numeric.js" type="text/javascript"></script>
    <script src="/static/jqGrid/js/i18n/grid.locale-en.js" type="text/javascript"></script>
    <script src="/static/jqGrid/js/jquery.jqGrid.min.js" type="text/javascript"></script>
    <script src="/static/jqGrid/js/jquery-ui-1.8.21.custom.min.js" type="text/javascript"></script>
    <script src="/static/js/design_steps.js" type="text/javascript"></script>


    <script type="text/javascript">
        // RECEIVE JSON DATA
        {% if gridData %}
            var gridData = {{ gridData|safe }};
        {% else %}
            var gridData = undefined;
        {% endif %}
        // END JSON DATA EVALUATION

        // curr_cat is passed from the server which specifies what current test case is. (only applicable when editing a case)
        {% if curr_cat %}
            var curr_cat = {{ curr_cat }};
        {% else %}
            // occurs when creating a new test case, so nothing should be defaulted
            // assign a negative pk, so nothing will match it
            var curr_cat = -1;
        {% endif %}

        $(document).ready( function(){
            makeRequired();
        })

    </script>

    <script src="/static/js/test_case_form.js" type="text/javascript"></script>

{% endblock %}
